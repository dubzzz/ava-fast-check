language: node_js
node_js:
  - "14"
script:
  - PROJECT_ROOT_PATH="$(pwd)"
  # Classical test workflow
  - npm run build
  - npm run test
  # Checking the bundle against commonjs and esm configurations
  ## Instead of linking on ., we pack the package as if it was released on npm registry
  ## then we link towards this version (no devDependencies installed, no unpublished files available...).
  - cd "$PROJECT_ROOT_PATH"
  - npm pack && mkdir -p bundle && tar -C bundle -zxvf ava-fast-check-*.tgz
  - rm -rf node_modules/
  ## CommonJS
  - cd "$PROJECT_ROOT_PATH"
  - cd test-bundle/commonjs && yarn && yarn test
  ## ESM
  - cd "$PROJECT_ROOT_PATH"
  - cd test-bundle/esm && yarn && yarn test
  ## Cleaning for deploy
  - cd "$PROJECT_ROOT_PATH"
deploy:
  provider: npm
  email: npm@dubien.org
  skip_cleanup: true
  api_key:
    secure: aXWpCKIKZzXB/OIrUlO5Y3wPOE4FMu8Ap26IAoxO5IFfqEuy5RgAngSedL2FDzj3SyO7vi7m5h5QEAaHRqncXLpZlp91KEjzMBQDcLE2urZ5qpBqCruiMzojVflpUwoRUw8H2yWmNp/iQYFNSbYeGh0cJfLDca8t4eEEqWa1hIlwVTu32lskgq53+Ok8AhdxYzfcSUuHKDksATeqwkSBbi5Q3GnK+S7aMpdspTPjEkl7g++5n7bKYYDqIcZJ29DtohbzKV4L1VYmbSPgSNW5+bXiFFvcezGVnGJRqNPT9i6YrZPsKP4v3Bzu1jsN4e047xQkh8/JyLvcgN9CPs4luPuban2uV30ZvvlKC8sG7U76uoyCGkx1m/vpy47DPTNhMxhSUKcurHW3GhHYOYFJrUhwh1OD+gx4eoaJwF0/TcXpxpIXz1/aeiRF3Un5X8I2QcsVI8xcXKJqC7GvqL9ZPv6XpNOnHtAFBQ5u7otjBnWtmf5SfltGLyM0UZvM3+tLwx7e28SjWCc43p7pc2a/UK6w4yG2LBdAop0pf8Dy5H2Rnjf5vPb3uALrqRLIOQ3vVbVdJx1W0LL0XHKsux3e301Safh4KzGnhtLL4y2sZk2Z1dghpe4CKlcHnV1QmAUMYMvbK5BGObT1Hkq9Cv49vMBZM9wB0/JuECtfCIgr8bE=
  on:
    tags: true
    repo: dubzzz/ava-fast-check
